---
layout:     post                    
title:      计算机网络学习        
subtitle:    arp协议分析
date:       2019-12-16             
author:     BY shahur                     
catalog: true                       
tags:                              
    - 计算机网络
    - arp
---
# arp协议分析
## 什么是arp协议
也叫作地址解析协议。工作在数据链路层。  
在局域网中实际传输的是帧，帧里面是目标主机的mac地址。  
在局域网中，两主机要通信，必须知道目的主机的mac地址。mac地址就是通过arp协议获得的。  
地址解析就是主机在发送帧之前将目标ip地址转换成目标mac地址的过程。
## arp欺骗的危害
造成内部网络的混乱，被欺骗的计算机无法正常访问内外网，让网关与客户机无法正常通信，也可以截取全网络的数据包等。  
arp协议工作在最底层，隐蔽性更高。系统无法像ip地址冲突那样给出提示。
## arp欺骗的原理
### 条件
攻击者也要处于与被攻击者同一个内网下，因为arp是工作在数据链路层，如果攻击者处于外网，外网与内网直接通讯需要根据ip。
### arp防护
主机自身ip与mac绑定在一起。但是ip变为静态，很难管理，在路由器、交换机做防护又很麻烦。所以大部分企业没有做arp防护。
中间人攻击（MITM）：
涵盖了arp欺骗攻击
### 原理
把自己的mac地址伪造成网关的地址来欺骗其他主机。
### 攻击方式
##### 单向arp攻击 
###### 欺骗主机方式
a,b通讯时，a先查询arp缓存表，要是没有b的mac地址，a会发送广播包，广播后整个局域网都收到了该广播包，此时攻击者响应a，说我是主机b，我的mac地址是xxxx，a收到后会更新自己的arp缓存表，a再次与b通讯时，该数据会转发到攻击者，再经过攻击者转发到b。
攻击者可以将截取数据选择转发或不转发给接受方。
由于单向攻击，一般情况下只会影响到一台主机，所以接受方的arp缓存表不改变，只改变发送方的arp缓存表。
##### 双向arp攻击
###### 欺骗主机方式
假如a和b要通信，攻击者向a说我才是b，攻击者又向b说我才是a，那么a、b的arp缓存表都修改了，以后通讯就是a、b通讯都会将数据先发给攻击者，再由攻击者发送给接受方。
###### 欺骗网关方式
 攻击者发送广播包 说自己是网关，a、b将自己的网关改为攻击者。
具体就是：攻击主机发送arp应答包给被攻击者和网关，它们分别修改其arp缓存表，修改的全是攻击者的mac地址，这样它们直接数据都会被攻击者截获。
## arp实战测试
### 用户名密码窃取
被攻击者向ftp、http、imap、smb、telnet、vnc、mysql等服务器发送数据时，都可以使用cainarp攻击软件截获到。
### dns欺骗
将访问网站解析到欺骗的ip地址上。
