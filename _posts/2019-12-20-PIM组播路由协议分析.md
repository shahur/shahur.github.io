---
layout:     post                    
title:      计算机网络学习        
subtitle:    PIM协议无关组播分析
date:       2019-12-19             
author:     BY shahur                     
catalog: true                       
tags:                              
    - 计算机网络
    - PIM
---
# PIM协议无关组播分析
## 概述
协议无关指的是与单播路由协议无关，即PIM不需要维护专门的单播路由协议，作为组播路由解决方案，它直接利用单播路由表的路由协议，对报文进行RPF检查，检查通过后创建组播路由表项。
## 组播分发树的分类
### SPT最短路径树
源树是以组播源为树根的组播分发树
### RPT共享树
共享树使用RP作为汇聚点
多个组播组可以共用一个RP
## RPF反向路径转发
实现数据转发的无环化
为确保组播数据从正确的接口收到，只有通过RPF检查的数组播数据包才会被路由器沿组播树进行转发。
当一个组播路由器同时受到来自多个组播路由器转发的组播流量，会对每个流量进行RPF检查，就是查的单播路由表，找出source的出接口，则此接口的组播流量通过RPF检查，其他转发过来的组播流量扔掉。
## 组播路由协议分类
### PIM-DM（密集模式协议）
使用push模式，一般应用于组成员规模相对较小，相对密集的网络。Push模式期初会将组播数据推送到网络的各个网络，再通过不需要组播流量的路由器进行剪枝操作将自己从组播分发树上修剪掉。
#### 发送操作：
初始，进行扩散组播流量，不存在组播组成员的分支也会收到组播流量。此时，每一台组播路由器都会在组播路由表中创建（S，G）路由表项，S为组播源地址（source）G为组播地址。
#### 剪枝（Prune）操作：
不需要（S，G）组播流量的分支，此分支路由器会发送PIM Orune报文将直击从组播分发树上剪除，意思为从（S，G）表项的出接口列表移除。
#### 嫁接（Graft）操作：
原先不在SPT上的网络分支出现接受者由最后一条路由器向上游邻居发送PIM Graft报文，进行加入组播分发树。
#### 报文类型：
Hello：用于建立及维护PIM邻居关系
Join/Prune 加入/剪枝报文
Graft：嫁接报文
Graft-ack：嫁接确认报文，用于对邻居发送的Graft报文进行确认
Assert：断言报文，用于断言机制，防止一个网段有多个组播路由器会对这个网段转发多个组播流量
#### PIM邻居关系
PIM路由器的接口被激活时，会向外发送建立邻居关系的hello包。
hello包目的地址为224.0.0.13（专门用来PIM协议表示同一网段中所有PIM路由器），源地址为接口的IP，ttl为1表示在此网络段转发最大的条数为1.
Hello包作用：发现PIM邻居，协调各项OIM协议报文的参数，维持邻居关系。
**只有当邻居关系建立成功后，PIM路由器才能接受其他PIM协议报文，从而创建组播路由表项。
### PIM-SM稀疏模式协议
应用于组成员规模相对较大，相对稀疏的网络模型。，使用Pull方式，只有设备用加入（join）机制来申请加入组播分发树。
#### RP：
汇聚点，为随时出现的组成员或组播源服务，网络中所有PIM路由器都知道RP的位置。
#### 注册源信息：
当网络中出现活跃的组播源（源向某组播G发送第一个组播数据）时，第一跳路由器将组播数据封装在Register报文中单播发往RP，在RP上创建（S，G）表项，注册源信息。
#### 关键机制
邻居发现，DR竞选，RPT构建，组播源祖册、断言。
#### join操作：
当网络中出现组成员是，由最后一跳路由器向RP（汇聚点）发送join报文，**逐级创建（*，G）表项**，生成一颗以RP为根的RPT
### 双向PIM
